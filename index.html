<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loja do Rio - Painel Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0f0f0f; color: white; font-family: sans-serif; }
        .card { background-color: #1e1e1e; border-radius: 12px; overflow: hidden; transition: 0.3s; border: 1px solid #2a2a2a; }
        .card:hover { transform: translateY(-5px); border-color: #3b82f6; }
        .hidden { display: none; }
    </style>
</head>
<body>

    <nav class="p-4 border-b border-gray-800 flex justify-between items-center bg-[#1e1e1e] sticky top-0 z-50">
        <h1 class="font-bold text-xl tracking-tighter text-white">LOJA DO RIO</h1>
        <div id="auth-section">
            <button id="btn-login" class="bg-white text-black px-5 py-2 rounded-lg font-bold hover:bg-gray-200 transition">Entrar com Google</button>
            <div id="user-info" class="hidden flex items-center gap-4">
                <span id="user-name" class="text-sm font-bold text-blue-400"></span>
                <button id="btn-logout" class="bg-red-600/20 text-red-500 px-3 py-1 rounded border border-red-600/50 text-xs uppercase font-black hover:bg-red-600 hover:text-white transition">Sair</button>
            </div>
        </div>
    </nav>

    <section id="admin-panel" class="p-6 hidden animate-pulse-slow">
        <div class="max-w-2xl mx-auto bg-[#1e1e1e] p-8 rounded-2xl border-2 border-dashed border-blue-600/30">
            <h2 class="text-2xl font-black mb-6 flex items-center gap-2">ðŸ“¦ ADICIONAR AO ESTOQUE</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input type="text" id="prod-name" placeholder="Nome do Produto (Ex: BMW X4)" class="w-full p-3 bg-black border border-gray-700 rounded-lg focus:border-blue-500 outline-none">
                <input type="number" id="prod-price" placeholder="PreÃ§o em R$" class="w-full p-3 bg-black border border-gray-700 rounded-lg focus:border-blue-500 outline-none">
                <input type="text" id="prod-img" placeholder="Link da Imagem (Discord/Imgur)" class="w-full p-3 bg-black border border-gray-700 rounded-lg focus:border-blue-500 outline-none md:col-span-2">
                <button id="btn-save" class="md:col-span-2 bg-blue-600 py-4 rounded-xl font-black text-lg hover:bg-blue-500 shadow-lg shadow-blue-900/20 transition">PUBLICAR PRODUTO</button>
            </div>
        </div>
    </section>

    <main class="p-8 max-w-7xl mx-auto">
        <h2 class="text-3xl font-black mb-8 italic uppercase tracking-widest">Produtos</h2>
        <div id="products-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
            </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // Suas chaves configuradas
        const firebaseConfig = {
            apiKey: "AIzaSyByENqzpEK5rxcGwMdzvl5zkDxGbYJJxc0",
            authDomain: "loja-bot-dc.firebaseapp.com",
            projectId: "loja-bot-dc",
            storageBucket: "loja-bot-dc.firebasestorage.app",
            messagingSenderId: "870156992524",
            appId: "1:870156992524:web:8eadf2cb44dcf0bcbd2e29",
            measurementId: "G-QXWYKJ5PDX"
        };

        // ALTERE PARA O SEU EMAIL REAL DO GOOGLE
        const DONO_EMAIL = "seu-email@gmail.com"; 

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        const btnLogin = document.getElementById('btn-login');
        const btnLogout = document.getElementById('btn-logout');
        const adminPanel = document.getElementById('admin-panel');
        const productsGrid = document.getElementById('products-grid');

        // Login e Logout
        btnLogin.onclick = () => signInWithPopup(auth, provider);
        btnLogout.onclick = () => signOut(auth);

        // Verificar quem estÃ¡ logado
        onAuthStateChanged(auth, (user) => {
            if (user) {
                btnLogin.classList.add('hidden');
                document.getElementById('user-info').classList.remove('flex');
                document.getElementById('user-info').classList.remove('hidden');
                document.getElementById('user-info').classList.add('flex');
                document.getElementById('user-name').innerText = user.displayName;
                
                if (user.email === DONO_EMAIL) {
                    adminPanel.classList.remove('hidden');
                }
            } else {
                btnLogin.classList.remove('hidden');
                document.getElementById('user-info').classList.add('hidden');
                adminPanel.classList.add('hidden');
            }
        });

        // Salvar Produto
        document.getElementById('btn-save').onclick = async () => {
            const name = document.getElementById('prod-name').value;
            const price = document.getElementById('prod-price').value;
            const img = document.getElementById('prod-img').value;

            if(name && price && img) {
                await addDoc(collection(db, "produtos"), {
                    nome: name,
                    preco: price,
                    imagem: img,
                    data: Date.now()
                });
                alert("Sucesso!");
                document.getElementById('prod-name').value = "";
                document.getElementById('prod-price').value = "";
                document.getElementById('prod-img').value = "";
            }
        };

        // Renderizar Produtos com botÃ£o de apagar para o dono
        onSnapshot(query(collection(db, "produtos"), orderBy("data", "desc")), (snapshot) => {
            productsGrid.innerHTML = "";
            snapshot.forEach((res) => {
                const p = res.data();
                const id = res.id;
                const isOwner = auth.currentUser?.email === DONO_EMAIL;

                productsGrid.innerHTML += `
                    <div class="card relative">
                        ${isOwner ? `<button onclick="window.deleteProduct('${id}')" class="absolute top-2 right-2 bg-red-600 text-white p-1 rounded text-[10px] font-bold z-10">APAGAR</button>` : ''}
                        <img src="${p.imagem}" class="w-full h-44 object-cover">
                        <div class="p-5">
                            <h3 class="font-bold text-lg uppercase">${p.nome}</h3>
                            <p class="text-blue-500 text-[10px] font-bold mb-4 tracking-widest">ENTREGA IMEDIATA</p>
                            <div class="flex justify-between items-end">
                                <div>
                                    <span class="text-[10px] text-gray-500 block">PIX</span>
                                    <span class="text-2xl font-black italic text-white">R$ ${p.preco}</span>
                                </div>
                                <button class="bg-white text-black px-4 py-2 rounded-lg font-black text-sm hover:bg-blue-600 hover:text-white transition">COMPRAR</button>
                            </div>
                        </div>
                    </div>
                `;
            });
        });

        // FunÃ§Ã£o Global para deletar
        window.deleteProduct = async (id) => {
            if(confirm("Deseja excluir este item?")) {
                await deleteDoc(doc(db, "produtos", id));
            }
        };
    </script>
</body>
</html>
